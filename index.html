<!DOCTYPE html>
<html lang="en">

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Safeguard passwords by dividing them into pieces.">
	<title>PassGuardian: Safety in Numbers</title>
	<link href="assets/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<script src="assets/jquery-3.1.0.min.js"></script>
	<script src="assets/isaac.js"></script>
	<script src="assets/bootstrap-3.3.7/js/bootstrap.min.js"></script>
	<script src="assets/bower_components/crypto-js/crypto-js.js"></script>
	<script src="assets/secrets.js"></script>
	
	<style>
		.panel-content {
			padding: 5px 15px;
		}
	</style>
	
<script>
	secrets.setRNG(null, false);

	if(secrets.getConfig().unsafePRNG){
		secrets.setRNG(function(bits){
			str = '';
			while(str.length < bits || (str.match(/0/g)||[]).length === str.length){
				str += isaac.random().toString(2).substr(2);
			}
			return str.slice(0,bits)
		}, false)
	}

	function error(location, message, hide){
		$($(location).parent()).before('<div class="alert alert-error fade in popupError"><button type="button" class="close" data-dismiss="alert">&times;</button><h4>Error</h4>'+message+'</div>')
		if(hide){
			$(hide).hide();
		}
		$(location).removeClass('disabled');
	}
	
	$(document).ready(function() {
		$("#split-form").submit(function(ev) {
			ev.preventDefault();
			
			var el = $(this)
			if(el.hasClass('disabled')){
				return;
			}else{
				el.addClass('disabled');
			}
			
			if(secrets.getConfig().bits !== 8){
				secrets.init(8);
			}
			$('#split-tab .popupError').remove();
			
			var string = $('#string').val();
			if(string === ''){
				return error(this, 'Input cannot be empty.', '#split-result')
			}
			var hash = CryptoJS.SHA3(string);
			
			var numShares = $('#numShares').val() * 1;
			if(typeof numShares !== 'number' || isNaN(numShares) || numShares < 2 || numShares > 255){
				return error(this, 'Number of shares must be an integer between 2 and 255, inclusive.', '#split-result')
			}
			
			var threshold = $('#threshold').val() * 1;
			if(typeof threshold !== 'number' || isNaN(threshold) || threshold < 2 || threshold > 255 || threshold > numShares){
				return error(this, 'Threshold must be an integer between 2 and your selected number of shares, inclusive.', '#split-result')
			}
			
			string = secrets.str2hex(string);
			
			if(!$('#shares').length){
				$(this).parent().after('<div id="split-result" style="display:none;" class="alert alert-block alert-success fade in"><button type="button" class="close" data-dismiss="alert">&times;</button><h4>Secret shares</h4>One share per line<pre id="shares"></pre></div>');
			}
			try{
				var shares = secrets.share(string, numShares, threshold);
				var textarea = $('#shares');
				shares = shares.join('<br>');
				textarea.html(shares);
				$('#split-hash').text(hash)
				$('#split-result').show();
				secrets.getConfig().unsafePRNG ? $('#PRNGwarning').show() : $('#PRNGwarning').hide();
				numShares<threshold ? $('#mismatchWarning').show() : $('#mismatchWarning').hide();
			}catch(e){
				return error(this, e, '#split-result')
			}
			el.removeClass('disabled');
		});
		
		$("#recon-form").submit(function(ev) {
			ev.preventDefault();
			
			$('#recon-tab .popupError').remove();
			var inputHash = $('#inputhash').val();
			var shares = $("#recon-shares").val().split("\n");
		
			if(shares.length<2){
				return error(this, 'Enter at least 2 shares.', '#recon-result')
			}
		
			if(!$('#reconstruction').length){
				$(this).parent().after('<div id="recon-result" style="display:none;" class="alert alert-block alert-success fade in"><button type="button" class="close" data-dismiss="alert">&times;</button><h4>Reconstructed secret</h4><pre id="reconstruction"></pre></div>');
			}
			try{
				var recon = secrets.combine(shares);
				recon = secrets.hex2str(recon);
				$('#reconstruction').text(recon);
				
				$('#recon-result').show();
				
			}catch(e){
				return error(this, 'Reconstruction ' + e, '#recon-result')
			}
		});
	});

	$(document).on('click', '.generate', function(ev){
		ev.preventDefault();
		var rnd = secrets.random($(this).attr('data-bits') * 1);
		$('#string').replaceWith('<input class="input-block-level" id="string" type="text" placeholder="Secret to share" value="'+rnd+'">')
		$('.inputType[data-inputType=text]').removeClass('active')
		$('.inputType[data-inputType=hex]').addClass('active')
	})

	$(document).on('click','.inputType[data-inputType=hex]', function(ev){
		var string = $('#string');
		var val = string.val().replace(/\n/g,' ');
		if(string.is('textarea')){
			string.replaceWith('<input class="input-block-level" id="string" type="text" placeholder="Secret to share" value="'+val+'">')
		}
	})
	$(document).on('click','.inputType[data-inputType=text]', function(ev){
		var string = $('#string');
		var val = string.val();
		if(!string.is('textarea')){
			string.replaceWith('<textarea class="input-block-level" id="string" type="text" rows="3" placeholder="Secret to share">'+val+'</textarea>')
		}
	})

	$(document).on('click', '#split-simple', function(ev){
		$('#split .advancedElement').hide();
		$('.reconType.active').removeClass('active');
		$('.reconType[data-inputType=text]').addClass('active');
	});

	$(document).on('click', '#split-advanced', function(ev){
		$('#split .advancedElement').show();
	})
	$(document).on('click', '#recon-advanced', function(ev){
		$('#reconstruct .advancedElement').show();
	})

	$(document).on('click', '#recon-simple', function(ev){
		$('#reconstruct .advancedElement').hide();
		$('.reconType.active').removeClass('active');
		$('.reconType[data-inputType=text]').addClass('active');
	});
	
	$(document).ready(function() {
		$("a.my-tooltip").tooltip();
	});
</script>
</head>

<body>
	<div class="container">
		<div class="page-header">
			<h1>PassGuardian-simple <small style="font-size: 18px;">Fork of <a href="https://htmlpreview.github.io/?https://github.com/amper5and/secrets.js/blob/gh-pages/index.html" style="color: #777; text-decoration: underline;">PassGuardian / secrets.js</a></small></h1>
		</div>
		
		<p>
			<b>Never store your secrets in one place again.</b> Store and share your secrets safely by splitting them into cryptographically-secure pieces. To reconstruct the original, combine a specific number of these pieces. Use PassGuardian-simple to safeguard passwords, private keys, account numbers, secret messages, files...really, any data!
		</p>
		
		<div class="alert alert-block alert-info">All computations are performed in your browser. Your secret and the computed shares are never transmitted anywhere.</div>
		
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Split a secret - <a href="about.html" style="font-weight: normal; font-size: 14px;">Read about the theory</a></h3>
			</div>
			<div class="panel-body">
				<div class="panel-content">
					<form id="split-form">
						<div class="control-group">
							<textarea class="form-control" id="string" type="text" rows="3" placeholder="Secret to split"></textarea>
						</div>
						
						<div class="row" style="margin: 10px -15px 10px -15px;">
							<div class="col-md-6">
								<div class="input-group">
									<span class="input-group-addon">Number of shares <a class='my-tooltip' data-toggle="tooltip" data-placement="right" data-html="true" style="font-size: 16px;" title="The number of shares (pieces) to split the secret into."><i class='glyphicon glyphicon-info-sign'></i></a></span>
									<input id="numShares" type="number" class="form-control" step="1" value="2" min="2" max="255" style="margin-right: 30px;">
								</div>
							</div>
							<div class="col-md-6">
								<div class="input-group">
									<span class="input-group-addon">Threshold <a class='my-tooltip' data-toggle="tooltip" data-placement="right" data-html="true" style="font-size: 16px;" title="The number of shares (pieces) needed to reconstruct the secret."><i class='glyphicon glyphicon-info-sign'></i></a></span>
									<input id="threshold" type="number" class="form-control" step="1" value="2" min="2" max="255" style="margin-right: 50px;">
								</div>
							</div>
						</div>
						
						<div class="control-group">
							<input type="submit" class="btn btn-primary btn-large" value="Split"></input>
						</div>
					</form>
					
					<div id="PRNGwarning" style="display: none;" class="alert alert-block alert-warning"><h4>Security Notice</h4> A cryptographically-strong random number generator was not found in your browser. Consider switching to a new browser. The computed shares will not be as secure as possible.</div>
					<div id="split-result" style="display:none; margin-top: 10px;">
						<div class="alert alert-block alert-success fade in">
							Secret shares
							<pre id="shares"></pre>
						</div>
					</div>
					<div id="mismatchWarning" style="display: none;" class="alert alert-block alert-warning"><h4>Notice</h4> The number of generated shares is less than the threshold and will not be enough to reconstruct the secret.</div>
				</div>
			</div>
		</div>
		
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Reconstruct a secret - <a href="#about" style="font-weight: normal; font-size: 14px;">Read about the theory</a></h3>
			</div>
			<div class="panel-body">
				<div class="panel-content">
					<form id="recon-form" class="form-horizontal">
						<div id="inputShares" class="control-group">
							<textarea class="form-control" id="recon-shares" type="text" rows="5" placeholder="Enter shares to be reconstructed, one per line"></textarea>
						</div>
						<div class="control-group" style="margin-top: 10px;">
							<input type="submit" class="btn btn-primary btn-large" value="Reconstruct"></input>
						</div>
						<div id="recon-result" style="display:none; margin-top: 10px;">
							<div class="alert alert-block alert-success fade in">
								Reconstructed secret
								<pre id="reconstruction"></pre>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
    </div>
</body>
